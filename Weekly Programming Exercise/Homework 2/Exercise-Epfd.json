{"paragraphs":[{"text":"%md\n\n### Exercise 1: Build an Eventually Perfect Failure Detector\n\nAn Eventually Perfect Failure Detector (EPFD), in Kompics terms,  is a component that **provides** the following port *(already imported in the notebook)*.\n\n    class EventuallyPerfectFailureDetector extends Port {\n     indication[Suspect];\n     indication[Restore];\n    }\n\nSimply put, your component should indicate or 'deliver' to the application the following messages:\n\n    case class Suspect(src: Address) extends KompicsEvent;\n    case class Restore(src: Address) extends KompicsEvent;\n\nAs you have already learnt from the course lectures, an EPFD, defined in a partially synchronous model, should satisfy the following properties:\n\n1. **Completeness**:  Every process that crashes should be eventually suspected permanently by every correct process\n2. **Eventual Strong Accuracy**: No correct process should be eventually suspected by any other correct process\n   \nTo complete this assignment you will have to fill in the missing functionality denoted by the commented sections below and pass the property checking test at the end of this notebook.\nThe recommended algorithm to use in this assignment is *EPFD with Increasing Timeout and Sequence Numbers*,  which you can find at the second page of this [document](https://courses.edx.org/asset-v1:KTHx+ID2203.1x+2016T3+type@asset+block@epfd.pdf) in the respective lecture.\n\n\n","user":"anonymous","dateUpdated":"2021-02-05T16:33:52+0000","config":{"editorSetting":{},"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"fontSize":9,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Exercise 1: Build an Eventually Perfect Failure Detector</h3>\n<p>An Eventually Perfect Failure Detector (EPFD), in Kompics terms, is a component that <strong>provides</strong> the following port <em>(already imported in the notebook)</em>.</p>\n<pre><code>class EventuallyPerfectFailureDetector extends Port {\n indication[Suspect];\n indication[Restore];\n}\n</code></pre>\n<p>Simply put, your component should indicate or &lsquo;deliver&rsquo; to the application the following messages:</p>\n<pre><code>case class Suspect(src: Address) extends KompicsEvent;\ncase class Restore(src: Address) extends KompicsEvent;\n</code></pre>\n<p>As you have already learnt from the course lectures, an EPFD, defined in a partially synchronous model, should satisfy the following properties:</p>\n<ol>\n  <li><strong>Completeness</strong>: Every process that crashes should be eventually suspected permanently by every correct process</li>\n  <li><strong>Eventual Strong Accuracy</strong>: No correct process should be eventually suspected by any other correct process</li>\n</ol>\n<p>To complete this assignment you will have to fill in the missing functionality denoted by the commented sections below and pass the property checking test at the end of this notebook.<br/>The recommended algorithm to use in this assignment is <em>EPFD with Increasing Timeout and Sequence Numbers</em>, which you can find at the second page of this <a href=\"https://courses.edx.org/asset-v1:KTHx+ID2203.1x+2016T3+type@asset+block@epfd.pdf\">document</a> in the respective lecture.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1612347908932_1216907660","id":"20160909-160459_701472878","dateCreated":"2021-02-03T10:25:08+0000","dateStarted":"2021-02-05T16:33:52+0000","dateFinished":"2021-02-05T16:33:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:948"},{"text":"import se.kth.edx.id2203.core.Ports._\nimport se.kth.edx.id2203.validation._\nimport se.sics.kompics.network._\nimport se.sics.kompics.sl.{Init, _}\nimport se.sics.kompics.timer.{ScheduleTimeout, Timeout, Timer}\nimport se.sics.kompics.{KompicsEvent, Start, ComponentDefinition => _, Port => _}","user":"anonymous","dateUpdated":"2021-02-05T16:33:55+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"editorHide":false,"fontSize":9,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"import se.kth.edx.id2203.core.Ports._<br />import se.kth.edx.id2203.validation._<br />import se.sics.kompics.network._<br />import se.sics.kompics.sl.{Init, _}<br />import se.sics.kompics.timer.{ScheduleTimeout, Timeout, Timer}<br />import se.sics.kompics.{KompicsEvent, Start, ComponentDefinition=>_, Port=>_}<br />"}]},"apps":[],"jobName":"paragraph_1612347908936_1215368664","id":"20160623-152816_923395673","dateCreated":"2021-02-03T10:25:08+0000","dateStarted":"2021-02-05T16:33:55+0000","dateFinished":"2021-02-05T16:33:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:949"},{"text":"  //Custom messages to be used in the internal component implementation\n  case class CheckTimeout(timeout: ScheduleTimeout) extends Timeout(timeout);\n\n  case class HeartbeatReply(seq: Int) extends KompicsEvent; // object Pong extends KompicsEvent\n  case class HeartbeatRequest(seq: Int) extends KompicsEvent; // object Ping extends KompicsEvent","user":"anonymous","dateUpdated":"2021-02-05T16:33:58+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"defined class CheckTimeout<br />defined class HeartbeatReply<br />defined class HeartbeatRequest<br />"}]},"apps":[],"jobName":"paragraph_1612347908937_1214983915","id":"20160830-153841_517626554","dateCreated":"2021-02-03T10:25:08+0000","dateStarted":"2021-02-05T16:33:58+0000","dateFinished":"2021-02-05T16:33:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:950"},{"text":"//Define EPFD Implementation\nclass EPFD(epfdInit: Init[EPFD]) extends ComponentDefinition {\n\n  //EPFD subscriptions\n  val timer = requires[Timer];\n  val pLink = requires[PerfectLink];\n  val epfd = provides[EventuallyPerfectFailureDetector];\n\n  // EPDF component state and initialization\n  \n  //configuration parameters\n  val self = epfdInit match {case Init(s: Address) => s};\n  val topology = cfg.getValue[List[Address]](\"epfd.simulation.topology\");\n  val delta = cfg.getValue[Long](\"epfd.simulation.delay\"); // delay := ∆\n  \n  // mutable state\n  var period = cfg.getValue[Long](\"epfd.simulation.delay\"); // counter in Pong.scala, delay := ∆\n  var alive = Set(cfg.getValue[List[Address]](\"epfd.simulation.topology\"): _*);\n  var suspected = Set[Address]();\n  var seqnum = 0;\n\n  // STARTTIMER(delay)\n  def startTimer(delay: Long): Unit = {\n    val scheduledTimeout = new ScheduleTimeout(period);\n    scheduledTimeout.setTimeoutEvent(CheckTimeout(scheduledTimeout));\n    trigger(scheduledTimeout -> timer);\n  }\n\n  // EPFD event handlers\n  ctrl uponEvent {\n    case _: Start =>  {\n      // upon event ⟨ Init ⟩ do\n      // startTimer(period);\n      trigger(Suspect(self) -> epfd);\n      trigger(Restore(self) -> epfd);\n    }\n  }\n  \n  // timer event handlers\n  timer uponEvent {\n    case CheckTimeout(_) =>  {\n      // if alive ∩ suspected != ∅ then\n      if (!alive.intersect(suspected).isEmpty) {\n          // delay := delay + ∆\n          period = period + delta;\n      }\n      \n      seqnum = seqnum + 1;\n      \n      // forall p∈Π do\n      for (p <- topology) {\n        // if (p ∈/ alive) ∧ (p ∈/ suspected) then\n        if (!alive.contains(p) && !suspected.contains(p)) {\n            // suspected := suspected ∪ {p}\n            suspected = suspected + p;\n            // trigger ⟨ ♦P, Suspect | p ⟩\n            trigger(Suspect(p) -> epfd);\n           \n        } else if (alive.contains(p) && suspected.contains(p)) {\n          // suspected := suspected \\ {p}\n          suspected = suspected - p;\n          // trigger ⟨ ♦P, Restore | p ⟩\n          trigger(Restore(p) -> epfd);\n        }\n        // trigger ⟨ pp2p, Send | p, [HeartbeatRequest, seqnum] ⟩\n        trigger(PL_Send(p, HeartbeatRequest(seqnum)) -> pLink);\n      }\n      // alive := ∅\n      alive = Set[Address]();\n      // startTimer(delay)\n      startTimer(period);\n    }\n  }\n\n  // pLink event handler\n  pLink uponEvent {\n    // upon event ⟨ pp2p, Deliver | p, [HeartbeatRequest, n] ⟩ do\n    case PL_Deliver(src, HeartbeatRequest(seq)) =>  {\n        // trigger ⟨ pp2p, Send | p, [HeartbeatReply, n] ⟩\n        trigger(PL_Send(src, HeartbeatReply(seq)) -> pLink);\n    }\n    // upon event ⟨ pp2p, Deliver | p, [HeartbeatReply, n] ⟩ do\n    case PL_Deliver(src, HeartbeatReply(seq)) => {\n        // if n = seqnum ∨ p ∈ suspected then\n        // p is src here and n is seq\n        if (seq==seqnum || suspected.contains(src)){\n            // alive := alive ∪ {p}\n            alive = alive + src;\n        }\n    }\n  }\n};","user":"anonymous","dateUpdated":"2021-02-05T16:47:24+0000","config":{"lineNumbers":true,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"defined class EPFD<br />"}]},"apps":[],"jobName":"paragraph_1612347908937_1214983915","id":"20160728-151056_2139297732","dateCreated":"2021-02-03T10:25:08+0000","dateStarted":"2021-02-05T16:47:24+0000","dateFinished":"2021-02-05T16:47:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:951"},{"text":"checkEPFD[EPFD]","user":"anonymous","dateUpdated":"2021-02-05T16:47:27+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<br />Your submission has been locally simulated and validated.<br /><br /><a href=\"\\static\\log.txt\" target=\"_blank\">Click Here</a> to view the output of the simulation.<br /><style type=\"text/css\">.tg  {border-collapse:collapse;border-spacing:0;border-color:#aabcfe;}.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aabcfe;color:#669;background-color:#e8edff;}.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aabcfe;color:#039;background-color:#b9c9fe;}.tg .tg-mb3i{background-color:#D2E4FC;text-align:right;vertical-align:top}.tg .tg-lqy6{text-align:right;vertical-align:top}.tg .tg-vlnx{background-color:#3071a9;color:#ffffff;text-align:center;vertical-align:top}.tg .tg-6k2t{background-color:#D2E4FC;vertical-align:top}.tg tg-6k2l{background-color:#ffb3b3;vertical-align:top}.tg .tg-yw4l{vertical-align:top}</style><table class=\"tg\">  <tr>    <th class=\"tg-vlnx\" colspan=\"3\">Correction Results</th>  </tr><br /><tr>    <td class=\"tg-6k2t\">PASSED</td> <td class=\"tg-6k2t\">Strong Completeness</td> <td class=\"tg-6k2t\">✔: Every process that crashes is eventually suspected permanently by every correct process<br></td>  </tr>  <br /><tr>    <td class=\"tg-6k2t\">PASSED</td> <td class=\"tg-6k2t\">Eventual Strong Accuracy</td> <td class=\"tg-6k2t\">✔: Eventually, no correct process is suspected by any correct process<br></td>  </tr>  <br /></table><br />Final Comments<br />**************<br />Congratulations! Your implementation of the 'Eventually Perfect Failure Detector' satisfies all properties! <br />A unique token has been generated for your submission right below. Please do not edit. <br /><br />{\"gradingToken\":[45,45,45,45,45,66,69,71,73,78,32,80,71,80,32,77,69,83,83,65,71,69,45,45,45,45,45,10,86,101,114,115,105,111,110,58,32,66,67,80,71,32,118,49,46,53,53,10,10,104,81,73,77,65,57,79,116,77,118,84,69,98,74,49,102,65,82,65,65,106,52,71,115,54,69,69,72,68,74,106,56,71,54,105,57,54,107,68,72,99,49,110,67,108,115,78,82,118,102,112,83,109,98,101,121,89,76,111,49,80,77,80,118,10,120,47,65,78,51,104,56,85,75,52,55,121,106,108,119,106,70,74,67,57,55,103,71,73,57,116,78,119,56,43,102,72,114,105,121,97,98,72,79,81,120,107,72,113,87,50,78,65,116,113,115,55,120,120,49,51,77,119,50,102,89,68,100,122,10,104,100,48,51,101,79,122,97,70,81,68,111,71,89,56,55,114,121,122,116,66,69,74,55,108,118,48,88,72,47,122,112,112,100,119,57,109,119,49,118,83,85,97,115,72,72,106,55,97,65,119,75,69,84,52,68,55,81,68,108,55,90,86,89,10,51,48,104,118,82,54,81,65,76,116,87,99,109,97,82,70,43,50,101,73,122,70,109,112,97,87,114,97,77,90,102,103,84,118,122,56,49,69,70,67,87,77,47,51,107,49,66,57,68,52,85,109,79,112,56,89,117,73,116,69,106,89,55,120,10,57,43,108,79,52,79,57,107,98,70,103,66,113,101,102,78,55,116,85,87,113,66,47,88,118,119,82,109,51,70,116,99,103,119,69,75,110,67,57,110,103,86,47,73,78,112,90,122,67,107,83,68,86,74,106,54,83,89,50,48,122,66,81,99,10,109,48,49,121,81,55,71,51,80,68,90,116,43,55,118,120,51,115,103,97,118,115,76,106,116,119,48,69,52,51,117,118,110,104,105,83,113,71,98,56,55,53,52,79,87,66,97,113,88,119,57,52,83,104,47,87,57,122,88,82,67,81,85,82,10,117,107,99,101,100,75,107,108,81,102,75,78,54,98,48,73,68,88,57,113,77,101,107,81,99,88,109,56,68,68,47,47,114,98,86,98,101,77,97,112,119,81,82,100,85,106,97,48,112,120,43,115,43,76,70,104,66,78,65,78,76,98,71,121,10,109,115,98,73,48,72,112,119,84,68,101,113,48,86,121,52,48,90,72,87,87,69,98,69,115,54,43,86,103,116,43,110,83,99,76,53,116,112,112,71,86,104,79,116,56,55,102,54,80,90,78,87,73,71,117,112,110,102,89,73,73,87,56,76,10,89,53,83,43,97,70,68,77,69,89,89,100,113,89,114,120,89,109,74,108,122,117,108,80,71,70,120,66,75,72,81,70,109,70,107,74,52,72,82,48,75,51,111,115,88,109,71,67,43,104,68,113,97,119,85,47,65,106,67,50,70,87,112,69,10,74,115,97,121,49,83,73,102,108,116,80,85,120,103,50,87,99,76,88,106,99,119,74,99,48,76,109,108,89,107,80,114,82,81,52,51,101,101,113,88,119,67,99,47,66,87,120,114,69,117,98,88,115,107,109,107,113,120,54,115,73,69,68,76,10,104,114,101,83,66,89,120,84,88,119,54,111,71,76,104,80,74,112,65,119,105,100,109,113,90,120,66,118,113,84,108,106,47,103,52,88,99,115,121,47,79,100,76,118,81,88,67,103,51,122,71,110,100,76,114,105,66,89,75,85,50,104,76,83,10,119,67,81,66,68,117,113,115,121,105,106,116,75,73,100,72,86,48,54,84,57,99,107,69,99,81,54,54,72,57,110,87,115,85,49,99,53,102,70,76,65,87,67,83,47,67,108,43,118,56,89,113,74,97,105,65,114,106,83,56,87,106,77,104,10,121,108,78,107,107,55,67,97,81,104,71,75,65,115,56,69,70,120,111,121,99,101,43,121,80,100,65,79,104,107,54,51,84,87,102,107,56,109,43,75,81,79,85,100,102,97,67,65,47,55,121,106,74,78,47,110,74,122,109,86,68,106,110,83,10,72,97,85,117,43,70,66,48,54,107,106,113,108,99,81,85,80,121,74,73,89,118,65,68,120,76,66,43,86,69,51,121,87,50,70,122,57,52,73,57,56,71,118,76,66,80,105,119,108,67,53,117,55,82,108,50,104,87,65,53,121,81,122,90,10,54,90,107,67,72,65,109,48,117,98,51,111,107,99,65,109,109,55,80,70,75,122,82,112,85,51,107,117,74,105,51,47,110,65,80,114,55,108,78,51,98,82,101,104,53,97,103,49,89,67,51,49,101,90,69,70,85,84,84,74,86,87,76,121,10,99,66,69,80,56,55,47,74,105,79,99,108,101,55,57,75,111,105,86,78,102,100,81,68,120,86,80,97,78,90,121,120,77,67,84,54,79,117,117,97,55,103,75,73,116,119,78,118,75,111,69,61,10,61,51,110,70,117,10,45,45,45,45,45,69,78,68,32,80,71,80,32,77,69,83,83,65,71,69,45,45,45,45,45,10]}<br />res2: Boolean = true<br />"}]},"apps":[],"jobName":"paragraph_1612347908937_1214983915","id":"20160704-003955_2062490082","dateCreated":"2021-02-03T10:25:08+0000","dateStarted":"2021-02-05T16:47:27+0000","dateFinished":"2021-02-05T16:47:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:952"},{"text":"","dateUpdated":"2021-02-03T10:25:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","colWidth":12,"fontSize":9,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1612347908937_1214983915","id":"20160728-143652_1894660652","dateCreated":"2021-02-03T10:25:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:953"}],"name":"Exercise-Epfd","id":"2FW7TB7E7","angularObjects":{"2BKQCVH92:shared_process":[],"2CVXXPNWV:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}